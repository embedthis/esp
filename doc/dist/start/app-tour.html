<!DOCTYPE html>
<html lang="en">
<head>
    <title>ESP Applications Tour</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <meta name="description" content="ESP web framework">
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Open+Sans:300italic,400,300,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Julius+Sans+One' rel='stylesheet' type='text/css'>
    <link href="https://embedthis.com/esp/doc/start/app-tour.html" rel="canonical">
    <link href="../images/favicon.ico" rel="shortcut icon">
    <link href="../lib/semantic-ui/semantic.min.css" rel="stylesheet" type="text/css">
    <link href="../css/all.min.css" rel="stylesheet" type="text/css">
    <link href="../css/api.min.css" rel="stylesheet" type="text/css">
    

</head>
<body class="show-sidebar">
    <div class="sidebar">
        <div class="ui large left vertical inverted labeled menu">
            <div class="item">
                <a href="../index.html" class="logo">ESP Docs</a>
            </div>
            <div class="item">
                <a href="../index.html">
                    <b>General</b>
                </a>
                <div class="menu">
                    <a class="item" href="../index.html">ESP Overview</a>
                    <a class="item" href="../users/features.html">ESP Features</a>
                    <a class="item" href="https://embedthis.com/esp/download.html">Download</a>
                    <a class="item" href="../licensing/index.html">Licensing</a>
                </div>
            </div>
            <div class="item">
                <a href="../start/index.html">
                    <b>Getting Started</b>
                </a>
                <div class="menu">
                    <a class="item" href="../start/quick.html">Quick Start</a>
                    <a class="item" href="../start/installing.html">Installing ESP</a>
                    <a class="item" href="../start/tour.html">ESP Tour</a>
                    <a class="item" href="../start/app-tour.html">ESP Applications Tour</a>
                    <a class="item" href="../start/spa-tour.html">ESP SPA Tour</a>
                    <a class="item" href="../start/releaseNotes.html">Release Notes</a>
                    <a class="item" href="../start/source.html">Building from Source</a>
                </div>
            </div>
            <div class="item">
                <a href="../users/index.html"><b>User's Guide</b></a>
                <div class="menu">
                    <a class="item" href="../users/create.html">Creating ESP Applications</a>
                    <a class="item" href="../users/packages.html">Extension Packages</a>
                    <a class="item" href="../users/skeletons.html">Application Skeletons</a>
                    <a class="item" href="../users/config.html">Configuring ESP</a>
                    <a class="item" href="../users/components.html">Generating Components</a>
                    <a class="item" href="../users/building.html">Building Applications</a>
                    <a class="item" href="../users/deploying.html">Deploying Applications</a>
                    <a class="item" href="../users/pages.html">ESP Pages</a>
                    <a class="item" href="../users/layouts.html">Expansive Layouts</a>
                    <a class="item" href="../users/controllers.html">ESP Controllers</a>
                    <a class="item" href="../users/database.html">Databases</a>
                    <a class="item" href="../users/migrations.html">Database Migrations</a>
                    <a class="item" href="../users/sessions.html">Session Storage</a>
                    <a class="item" href="../users/security.html">Security Considerations</a>
                    <a class="item" href="../users/monitor.html">Monitoring and Defending</a>
                    <a class="item" href="../users/hosting.html">Hosting in Appweb</a>
                    <a class="item" href="../users/command.html">ESP Command</a>
                    <a class="item" href="../users/man.html">Manual Pages</a>
                </div>
            </div>
            <div class="item">
                <a href="../ref/index.html">Reference Guide</a>
                <div class="menu">
                    <a class="item" href="../ref/mvc.html">ESP MVC Framework</a>
                    <a class="item" href="../ref/compatibility.html">Compatibility</a>
                    <a class="item" href="../ref/native.html">API Library</a>
                    <a class="item" href="../ref/memory.html">ESP Memory Allocation</a>
                    <a class="item" href="../ref/multithread.html">Multithreaded Programming</a>
                </div>
            </div>
            <div class="item">
                <a href="../users/samples.html">Samples</a>
                <div class="menu">
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/config">config</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/controller">controller</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/html-mvc">html-mvc</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/layout">layout</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/login-database">login-database</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/login-form">login-form</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/login-roles">login-roles</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/page">page</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/session">session</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/upload">upload</a>
                </div>
            </div>
            <div class="item">
                <a href="../users/project.html">Project Resources</a>
                <div class="menu">
                    <a class="item" href="https://embedthis.com/blog/categories/ESP/">Official ESP News</a>
                    <a class="item" href="https://embedthis.com/esp/">ESP Web Site</a>
                    <a class="item" href="https://github.com/embedthis/esp">Source Code Repository</a>
                    <a class="item" href="https://github.com/embedthis/esp/issues">Project Issue Database</a>
                    <a class="item" href="https://github.com/embedthis/esp/releases">Change Log</a>
                    <a class="item" href="https://github.com/embedthis/esp/milestones">Roadmap</a>
                    <a class="item" href="https://embedthis.com/developers/contributors.html">Contributors Agreement</a>
                </div>
            </div>
            <div class="item">
                <b>Links</b>
                <div class="menu">
                    <a class="item" href="https://embedthis.com/">Embedthis Web Site</a>
                    <a class="item" href="https://embedthis.com/blog/">Embedthis Blog</a>
                    <a class="item" href="http://twitter.com/embedthat">Twitter</a>
                </div>
            </div>
        </div>
    </div>



    <div class="ui inverted masthead">
        <div class="ui fixed inverted menu">
            <div class="ui sidebar-launch button">
                <i class="icon list layout"></i>
            </div>
            <div class="right menu">
                <a class="item" href="https://embedthis.com/">Embedthis</a>
                    <a class="item" href="https://embedthis.com/esp/">ESP Site</a>
                    <span class="desktop-only">
                        <a class="item" href="https://embedthis.com/blog/categories/ESP/">ESP News</a>
                        <a class="item" href="https://github.com/embedthis/esp">Repository</a>
                        <a class="item" href="https://embedthis.com/blog/">Blog</a>
                        <a class="item" href="https://twitter.com/embedthat">Twitter</a>
                    </span>

            </div>
        </div>
        
        <div class="ui breadcrumb">
            <a class="section" href="../">Home</a>
            
            <div class="divider">/</div>
            <a class="section" href="index.html">
                Getting Started
            </a>
            
            
            <div class="divider">/</div>
            <a class="active section" href="app-tour.html">ESP Applications Tour</a>
            
        </div>
        
        <iframe class="version desktop-only" src="../version.html"></iframe>

    </div>
    <div class="content">

            <h1>ESP Applications Tour</h1>
            <p>This tour provides an overview of creating ESP applications and the ESP MVC Framework.</p>

            <p>To create more complex ESP applications than a simple hello-world, we will typically
            want a bit more structure and content. The ESP MVC framework provides this structure
            and with sensible defaults, it greatly minimizes your workload.</p>

            <h2>Essential Tools</h2>
            <p>So you can work along as the tour progresses, install the following products and tools.
                ESP applications and this tour make good use of the
                <a href="https://embedthis.com/pak/">Pak</a> and
                <a href="https://embedthis.com/expansive/">Expansive</a> tools from Embedthis.
            </p>

            <ul>
                <li><a href="https://embedthis.com/pak/">Pak</a> manager to install and manage extension packages.</li>
                <li><a href="https://embedthis.com/expansive/">Expansive</a> site manager for layout pages
                    and web site tooling.</li>
            </ul>

            <p>Before starting, first make sure you have read the <a href="quick.html">Quick Start</a>,
            and the <a href="tour.html">ESP Tour</a> and that you have ESP, Pak and Expansive installed on your
            system so you can type along as you go.</p>

            <p>
                <a class="ui labeled small icon blue button" href="https://embedthis.com/esp/download.html">
                    <i class="download cloud icon"></i>
                    Download ESP</a>
                <a class="ui labeled small icon purple button" href="https://embedthis.com/pak/download.html">
                    <i class="download cloud icon"></i>
                    Download Pak
                </a>
                <a class="ui labeled small icon red button" href="https://embedthis.com/expansive/download.html">
                    <i class="download cloud icon"></i>
                    Download Expansive
                </a>
            </p>

            <a id="blog"></a>
            <h2>Creating a New Application</h2>
            <p>ESP provides skeletons to get you started quickly. These skeletons packages provide
            the core structure of your application and include pages, templates, stylesheets and scaffolds
            that are used to generate models, views and controllers as your application grows. </p>

            <p>To create a new ESP application, we will use the <a href="https://embedthis.com/pak/">Pak</a> package manager to install the <em>esp-html-skeleton</em> application skeleton. The <em>esp-html-skeleton</em> is a starter package for ESP HTML MVC applications with server-side views. Other skeletons include the <em>esp-vue-skeleton</em> for ESP VueJS applications with client-side views.</p>

            <h3>Install the Skeleton</h3>
            <p>First make a directory named <em>blog</em> and then install the <em>esp-html-skeleton</em> package.</p>
            <pre class="code"><b>$ mkdir blog
$ cd blog
$ pak init
$ pak install embedthis/esp-html-skeleton</b>
   [Install] exp-js 0.3.2
   [Install] exp-less 0.3.0
   [Install] exp-css 0.3.1
   [Install] exp-esp 0.3.1
   [Install] exp-html 0.2.0
   [Install] exp-canon 0.1.0
   [Install] esp-mvc 5.5.2
   [Install] esp-html-skeleton 5.5.1
</pre>
            <p>This simple command sequence accomplished quite a bit, including:</p>
            <ul>
                <li>Create a core structure with directories for various parts of the application. Initially, some of
                    these directories are empty, but they will be used as your application grows.</li>
                <li><p>Installed the <em>esp-html-skeleton</em>, <em>esp-mvc</em>,
                    <em>exp-js</em>, <em>exp-less</em>, <em>exp-css</em>,
                    and exp-esp packages. You can see these via the <em>pak list</em> command.</p>
                <li>Created <em>esp.json</em> and <em>pak.json</em> files that configures and control
                    how your application will run.</li>
                <li>Generated
            </ul>

            <h3>Render the Skeleton</h3>
            <p>Next, run the <b>expansive</b> command to render the skeleton web pages.</p>
            <pre class="code"><b>$ expansive render
      [Info] Using profile: debug
    [Render] css/all.css
    [Render] index.esp
      [Post] esp
       [Run] esp compile dist/index.esp
</b></pre>
            <p>This will render the web site including:</p>
            <ul>
                <li>Create the style sheets from the Less contents/css/*.less sheets</li>
                <li>Create the home page: index.esp from the master layouts/default.html.exp and the
                    reusable partial pages under the "partials" directory.</li>
                <li>Compile the ESP pages into loadable libraries under the "cache" directory.</li>
            </ul>

            <a id="run"></a>
            <h2>Access your Application</h2>
            <p>To access your application enter <em>http://localhost:4000</em> in your browser.
            You should see your first application home page.</p>
            <img src="../images/esp/app-tour/home.png" alt="home" class="bare-screen">

            <h2>Conventions</h2>
            <p>The ESP web framework follows the <em>convention over configuration</em> philosophy popularized by <a href="http://www.rubyonrails.org">Ruby on Rails</a>. This means that ESP adopts certain conventions about where files and directories should be placed and about how names are used. If you work with these conventions, then you need to do little or no configuration. Things will just work.</p>

            <p>Here are the most important files and directories:</p>
            <table title="directories" class="ui table segment">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>esp.json</td>
                        <td>Primary ESP configuration file</td>
                    </tr>
                    <tr>
                        <td>pak.json</td>
                        <td>This file specifies the application name, version and dependent packages.</td>
                    </tr>
                    <tr>
                        <td>cache</td>
                        <td>Cached compiled pages and controllers.</td>
                    </tr>
                    <tr>
                        <td>contents</td>
                        <td>Input content for the Expansive tool to render into <em>dist</em></td>
                    </tr>
                    <tr>
                        <td>contents/index.esp</td>
                        <td>Home page for your application.</td>
                    </tr>
                    <tr>
                        <td>dist</td>
                        <td>Distribution directory for browser visible web content including scripts,
                            pages and style-sheets. This is created from <em>contents</em>, <em>layouts</em>,
                            <em>lib</em> and <em>partials</em>.</td>
                    </tr>
                    <tr>
                        <td>controllers</td>
                        <td>Application controller code</td>
                    </tr>
                    <tr>
                        <td>db</td>
                        <td>Database file and database initialization scripts</td>
                    </tr>
                    <tr>
                        <td>layouts</td>
                        <td>Master page layouts used by Expansive</td>
                    </tr>
                    <tr>
                        <td>partials</td>
                        <td>Partial pages used by Expansive.</td>
                    </tr>
                    <tr>
                        <td>paks</td>
                        <td>Locally installed extension packages</td>
                    </tr>
                </tbody>
            </table>

            <a id="scaffolds"></a>
            <h2>Scaffolds</h2>
            <p>Scaffolding is a quick way to generate pieces of your application. Scaffolds are stub MVC resource
            managers that provide basic Create-Read-Update-Delete (CRUD) for a resource or group of resources.
            ESP scaffolds include:</p>

            <ul>
                <li>Database table schema</li>
                <li>Database migration to create the table</li>
                <li>Controller logic to create and mange table records</li>
                <li>Views to display table and record data</li>
            </ul>

            <p>Don't confuse ESP <em>scaffolds</em> with ESP <em>skeletons</em>. Skeletons are installable packages that are
            ready-made application starters. Scaffolds are generated MVC resource managers.</p>

            <p>Once the <em>esp-html-skeleton</em> framework pak is installed, the <em>esp</em> command can generate
            scaffolds. The command below will create a <em>post</em> scaffold that includes a database <em>post</em> table
            with a blog post title and post comment body. The <em>title</em> is a string data type and the <em>body</em> is a
            multi-line text field.</p>
            <pre class="code">
$ <b>esp generate scaffold post title:string body:text</b>
    [Create] Directory: controllers
    [Create] controllers/post.c
    [Create] Directory: contents/post
    [Create] contents/post/list.esp
    [Create] contents/post/edit.esp
    [Create] Directory: migrations
    [Create] migrations/201503311340450_create_scaffold_post.c
   [Compile] migrations/201503311340450_create_scaffold_post.c
   [Migrate] Apply 201503311340450_create_scaffold_post.c
   [Migrate] All migrations applied
  [Generate] Complete
       [Run] expansive render
      [Info] Using profile: debug
    [Render] css/all.css
    [Render] index.esp
    [Render] post/edit.esp
    [Render] post/list.esp
      [Post] esp
       [Run] esp compile dist/index.esp
       [Run] esp compile dist/post/edit.esp
       [Run] esp compile dist/post/list.esp
      [Info] Rendered 4 files to "dist". Elapsed time 0.94 secs.
</pre>
            <p>This command created:</p>
            <ul>
                <li>A server-side post Controller <em>controllers/post.c</em></li>
                <li>Server-side HTML views for listing posts <em>contents/post/list.esp</em> and editing posts
                    <em>contents/post/edit.esp</em>.</li>
                <li>A database migration to create the post database table.</li>
            </ul>

            <p>The command also ran the migration to create the database and table.</p>
            <p>Now if you set your browser to the home page, you will now see an empty listing of blog posts.</p>
            <p>
                <img src="../images/esp/app-tour/post-list.png" alt="postList" class="bare-screen">
                <a id="newPosts"></a>
            </p>

            <h2>Create New Posts</h2>
            <p>The New Post button directs your browser to the <em>/post/</em> URL. This form is being
            rendered on the client from the <em>contents/post/edit.esp</em> template. Behind the scenes, the
            browser asks for the <em>/post/init</em> URL to determine what are the required input fields
            for a post.</p>
            <img src="../images/esp/app-tour/create.png" alt="createPost" class="bare-screen">
            <p>Fill in the input fields and click OK to add the new blog post.</p>

            <img src="../images/esp/app-tour/post-list-2.png" alt="postList" class="bare-screen">
            <p>The home page is now updated with the first post.  You can click on the post title or body
            to edit its contents. This will run the same post-edit.html template that was used to create the post.</p>

            <h2 class=section>On the Server</h2>
            <p>When <em>OK</em> button is clicked to create a post, the browser invokes the
            <em>/post/</em> URL with the HTTP <em>POST</em> method to create the blog post. Esp
            parses this URL and and selects the appropriate request route and handler for the request. It
            then identifies <em>post</em> as the name of the server-side controller invokes the <em>createPost</em>
            action routine to service the request. The controller is automatically compiled and loaded if required.
            <p>A controller file typically defines many such C functions called actions, that are bound to specific URLs
            via ESP routes. Actions are defined using the <em>espAction</em> API in the initialization
            function of the controller.</p>
            <p>A minimal post controller file looks like this:</p>
            <pre class="code">
#include "esp.h"
static void createPost() {
    if (saveRec(createRec("post", params()))) {
        feedback("info", "New post Created");
        renderView("post/list");
    } else {
        feedback("error", "Cannot Create Post");
        renderView("post/edit");
    }
}
ESP_EXPORT int esp_controller_blog_post(EspRoute *eroute)
{
    espAction(route, "post/create", NULL, createPost);
    return 0;
}
</pre>
            <h3>Actions</h3>
            <p>The job of the action is to respond to the request and generate the response via views for the
            client. Here is the <em>listPost</em> action in the generated <em>post</em> controller.</p>
            <pre class="code">
static void listPost() {
    renderView("post/list");
}
</pre>
            <p>The <em>listPost</em> action simply renders the <em>post/list.esp</em> view page.</p>

            <h2>Code Errors</h2>
            <p>What happens if you make a mistake entering the embedded "C" code in your controller or in an ESP web page.
            Say you forgot the semicolon in the last example. You will see an error like this in your browser:</p>
            <img src="../images/esp/app-tour/error.png" alt="homeLink" class="bare-screen">
            <p>If you look at the esp console output, you also see full details about the request that failed.</p>
            <pre class="code">
14:10:20 1-0-1-1 request.error msg='Cannot run command: clang -c -DME_DEBUG -g -Wall -DPIC -fPIC -arch x86_64 -I. -Isrc -I/usr/local/lib/esp/5.4.0/inc controllers/post.c -o cache/controller_c1a25719dee243438859faa7d60c148d.o

controllers/post.c=46:28: error: expected ';' after expression
    renderView("post/list")
                           ^
                           ;
1 error generated.
</pre>

            <a id="validations"></a>
            <h2>Validations</h2>
            <p>Complete validation of all user entered data is essential for a robust and secure application. Some
            validation may be performed at the client, but full validation must always be fully implemented on
            the server incase the client or network connection is compromised. ESP provides flexible validation
            methods to help ensure the data you save at the server is correct.</p>

            <p>You can add calls to validate record data before it is saved to the database. To do this, edit the
            <em>controllers/post.c</em> file and add calls to <a href="../ref/api/edi.html#group___edi_1ga64cb0410a70843250c9826e8d12e3944">ediAddValidation</a>.</p>
            <pre class="code">
ESP_EXPORT int esp_controller_post(EspRoute *eroute)
{
    <b>Edi *edi;</b>
    /* Existing code */
    <b>edi = getDatabase();
    ediAddValidation(edi, "present", "post", "title", 0);
    ediAddValidation(edi, "present", "post", "body", 0);
    ediAddValidation(edi, "unique", "post", "title", 0);</b>
    return 0;
}
</pre>
            <p>This will cause the database to automatically ensure that the <em>title</em> and <em>body</em> fields are
            not blank and that the <em>title</em> is unique in the post database table.</p>

            <p>If you click OK in the Post <em>edit</em> web page without entering any data
            you will see the following:</p>

            <img src="../images/esp/app-tour/validate.png" alt="validate" class="bare-screen">
            <p>This automatically identified the input fields in error and generated a summary of the errors above the
            form. Of course, this default error highlighting behavior can be overridden if desired by modifying the
            application style sheets.<p>

            <p>Other validation types include: <em>checkNumber</em>, <em>checkBoolean</em>, <em>checkDate</em>
            and <em>checkFormat</em>. You can also define new validation types by calling
            <a href="../ref/api/edi.html#group___edi_service_1ga889df64bdd239f71c66b4fa920be8f46">ediDefineValidation</a>.

            <a id="hosting"></a>
            <h2>Hosting in Appweb</h2>
            <p>If you want to host your application in <a href="https://embedthis.com/appweb/">Appweb</a>,
            generate the required appweb.conf via:</p>

            <pre class="code">esp generate appweb</pre>

            <p>This will generate a stand-alone appweb.conf that includes the required
                EspApp directive to define your application. </p>
            <pre class="code">EspApp prefix="/demo" config="/path/to/esp.json</pre>


            <a id="learn"></a>
            <h2>Learn More ...</h2>
            <p>That concludes the a quick tour through some of the capabilities of the ESP web framework.
            To learn more, please read:
            <ul>
                <li><a href="index.html">ESP Documentation</a></li>
                <li><a href="../users/pages.html">ESP Pages</a></li>
            </ul>

    </div>
    <div class="terms ui basic center aligned segment">
        <p>&copy; Embedthis Software. All rights reserved.</p>
    </div>

    <script src="../lib/jquery/jquery.min.js"></script>
    <script src="../lib/semantic-ui/semantic.min.js"></script>
    <script src="../scripts/sidebar.min.js"></script>
     

    




