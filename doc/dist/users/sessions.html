<!DOCTYPE html>
<html lang="en">
<head>
    <title>Session Storage</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <meta name="description" content="ESP web framework">
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Open+Sans:300italic,400,300,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Julius+Sans+One' rel='stylesheet' type='text/css'>
    <link href="https://embedthis.com/esp/doc/users/sessions.html" rel="canonical">
    <link href="../images/favicon.ico" rel="shortcut icon">
    <link href="../lib/semantic-ui/semantic.min.css" rel="stylesheet" type="text/css">
    <link href="../css/all.min.css" rel="stylesheet" type="text/css">
    <link href="../css/api.min.css" rel="stylesheet" type="text/css">
    

</head>
<body class="show-sidebar">
    <div class="sidebar">
        <div class="ui large left vertical inverted labeled menu">
            <div class="item">
                <a href="../index.html" class="logo">ESP Docs</a>
            </div>
            <div class="item">
                <a href="../index.html">
                    <b>General</b>
                </a>
                <div class="menu">
                    <a class="item" href="../index.html">ESP Overview</a>
                    <a class="item" href="../users/features.html">ESP Features</a>
                    <a class="item" href="https://embedthis.com/esp/download.html">Download</a>
                    <a class="item" href="../licensing/index.html">Licensing</a>
                </div>
            </div>
            <div class="item">
                <a href="../start/index.html">
                    <b>Getting Started</b>
                </a>
                <div class="menu">
                    <a class="item" href="../start/quick.html">Quick Start</a>
                    <a class="item" href="../start/installing.html">Installing ESP</a>
                    <a class="item" href="../start/tour.html">ESP Tour</a>
                    <a class="item" href="../start/app-tour.html">ESP Applications Tour</a>
                    <a class="item" href="../start/spa-tour.html">ESP SPA Tour</a>
                    <a class="item" href="../start/releaseNotes.html">Release Notes</a>
                    <a class="item" href="../start/source.html">Building from Source</a>
                </div>
            </div>
            <div class="item">
                <a href="../users/index.html"><b>User's Guide</b></a>
                <div class="menu">
                    <a class="item" href="../users/create.html">Creating ESP Applications</a>
                    <a class="item" href="../users/packages.html">Extension Packages</a>
                    <a class="item" href="../users/skeletons.html">Application Skeletons</a>
                    <a class="item" href="../users/config.html">Configuring ESP</a>
                    <a class="item" href="../users/components.html">Generating Components</a>
                    <a class="item" href="../users/building.html">Building Applications</a>
                    <a class="item" href="../users/deploying.html">Deploying Applications</a>
                    <a class="item" href="../users/pages.html">ESP Pages</a>
                    <a class="item" href="../users/layouts.html">Expansive Layouts</a>
                    <a class="item" href="../users/controllers.html">ESP Controllers</a>
                    <a class="item" href="../users/database.html">Databases</a>
                    <a class="item" href="../users/migrations.html">Database Migrations</a>
                    <a class="item" href="../users/sessions.html">Session Storage</a>
                    <a class="item" href="../users/security.html">Security Considerations</a>
                    <a class="item" href="../users/monitor.html">Monitoring and Defending</a>
                    <a class="item" href="../users/hosting.html">Hosting in Appweb</a>
                    <a class="item" href="../users/command.html">ESP Command</a>
                    <a class="item" href="../users/man.html">Manual Pages</a>
                </div>
            </div>
            <div class="item">
                <a href="../ref/index.html">Reference Guide</a>
                <div class="menu">
                    <a class="item" href="../ref/mvc.html">ESP MVC Framework</a>
                    <a class="item" href="../ref/compatibility.html">Compatibility</a>
                    <a class="item" href="../ref/native.html">API Library</a>
                    <a class="item" href="../ref/memory.html">ESP Memory Allocation</a>
                    <a class="item" href="../ref/multithread.html">Multithreaded Programming</a>
                </div>
            </div>
            <div class="item">
                <a href="../users/samples.html">Samples</a>
                <div class="menu">
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/config">config</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/controller">controller</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/html-mvc">html-mvc</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/layout">layout</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/login-database">login-database</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/login-form">login-form</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/login-roles">login-roles</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/page">page</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/session">session</a>
                  <a class="item" href="https://github.com/embedthis/esp/tree/dev/samples/upload">upload</a>
                </div>
            </div>
            <div class="item">
                <a href="../users/project.html">Project Resources</a>
                <div class="menu">
                    <a class="item" href="https://embedthis.com/blog/categories/ESP/">Official ESP News</a>
                    <a class="item" href="https://embedthis.com/esp/">ESP Web Site</a>
                    <a class="item" href="https://github.com/embedthis/esp">Source Code Repository</a>
                    <a class="item" href="https://github.com/embedthis/esp/issues">Project Issue Database</a>
                    <a class="item" href="https://github.com/embedthis/esp/releases">Change Log</a>
                    <a class="item" href="https://github.com/embedthis/esp/milestones">Roadmap</a>
                    <a class="item" href="https://embedthis.com/developers/contributors.html">Contributors Agreement</a>
                </div>
            </div>
            <div class="item">
                <b>Links</b>
                <div class="menu">
                    <a class="item" href="https://embedthis.com/">Embedthis Web Site</a>
                    <a class="item" href="https://embedthis.com/blog/">Embedthis Blog</a>
                    <a class="item" href="http://twitter.com/embedthat">Twitter</a>
                </div>
            </div>
        </div>
    </div>



    <div class="ui inverted masthead">
        <div class="ui fixed inverted menu">
            <div class="ui sidebar-launch button">
                <i class="icon list layout"></i>
            </div>
            <div class="right menu">
                <a class="item" href="https://embedthis.com/">Embedthis</a>
                    <a class="item" href="https://embedthis.com/esp/">ESP Site</a>
                    <span class="desktop-only">
                        <a class="item" href="https://embedthis.com/blog/categories/ESP/">ESP News</a>
                        <a class="item" href="https://github.com/embedthis/esp">Repository</a>
                        <a class="item" href="https://embedthis.com/blog/">Blog</a>
                        <a class="item" href="https://twitter.com/embedthat">Twitter</a>
                    </span>

            </div>
        </div>
        
        <div class="ui breadcrumb">
            <a class="section" href="../">Home</a>
            
            <div class="divider">/</div>
            <a class="section" href="index.html">
                User's Guide
            </a>
            
            
            <div class="divider">/</div>
            <a class="active section" href="sessions.html">Session Storage</a>
            
        </div>
        
        <iframe class="version desktop-only" src="../version.html"></iframe>

    </div>
    <div class="content">

            <h1>Session Storage</h1>
            <p>Session storage is a limited, server-side, semi-permanent store for keeping state information across
            web requests. The HTTP protocol by design, encourages stateless implementations and so session state
            storage provides an essential context for a series of requests by a specific client.</p>

            <p>ESP provides a high performance, in-process session state store. The store is managed in that ESP
            imposes a session timeout on information and will automatically prune stale information. It uses the
            memory limit configured by the <a href="config.html#limits">http.limits</a> directive
            to restrict the amount of memory that is devoted to session state.</p>

            <a id="sample"></a>
            <h2>Sample Code</h2>
            <pre class="code">
if (!(id = <b>getSessionVar</b>("user-id")) != 0) {
    redirect("/login");
}
</pre>
            <p>You can also use the abbreviated API form:
                <a href="../ref/api/esp.html#group___esp_abbrev_1ga45c8bf65c9eacac2512533dbc006db2b">session()</a></p>
            <pre class="code">
if (!(id = <b>session</b>("user-id")) != 0) {
    redirect("/login");
}
</pre>
            <p>This example (above) tests if a "<em>user-id</em>" is defined in the session store. If not, the user must
            login and is redirect to the login page.</p>
            <pre class="code">
destroySession();
createSession();
</pre>
            <p>This forces the creation of a new session.</p>
<pre class="code">
setSessionVar("Name", "John");
</pre>
            <p>This defines the "<em>Name</em>" variable to the value "<em>John</em>".</p>
            <a id="apis"></a>
            <h2>ESP APIs</h2>
            <p>The ESP session state API is comprised of four key APIs:
            <ul>
                <li><a href="../ref/api/esp.html#group___esp_abbrev_1gab7b4049b554576b57f8cc49efc9e3a95">createSession</a></li>
                <li><a href="../ref/api/esp.html#group___esp_abbrev_1ga35677b9aa8d61543db5ea80377e823a6">destroySession</a></li>
                <li><a href="../ref/api/esp.html#group___esp_abbrev_1ga241f0cd4f5d49f8a137f1024415b2674">getSessionVar</a></li>
                <li><a href="../ref/api/esp.html#group___esp_abbrev_1gadb4f7bc3020ab9c481f1ebcaf1ed3f2a">setSessionVar</a></li>
            </ul>
            <a id="feedback"></a>
            <h2>Client Feedback</h2>
            <p>Controllers often need to provide out-of-band feedback to the client. This may be a simple notification that
            a record has been updated or deleted. Or it may be details of an error condition. ESP provides a simple
            feedback API to send such messages to the client.</p>
            <h3>Feedback Types</h3>
            <p>Feedback messages are divided into different types:</p>
            <ul>
                <li>Errors &mdash; An error occurred and the operation failed.</li>
                <li>Warnings &mdash; A warning has been issued, but the operation succeeded.</li>
                <li>Informational &mdash; The operation succeeded and this is just for feedback.</li>
                <li>Other &mdash; Any other kind of message.</li>
            </ul>
            <p>When ESP generates feedback messages in a web page, it emits a CSS style corresponding to the message type.
                This permits all errors to be flagged to the user using an "error" style. Similarly, for warnings and
                informational errors.
            <h3>Defining Feedback Messages</h3>
            <p>To issue a flash message for the next web page, use the
            <a href="../ref/api/esp.html#group___esp_abbrev_1ga360dc386da496f54f3131da667f7926b">feedback</a>
            API.</p>
<pre class="code">
feedback("inform", Document saved");
feedback("warn", "Session is about to expire in %d seconds", seconds);
feedback("error", "Could not save document");
feedback("custom", "Error code %d", code);
</pre>
            <p>To read a feedback message, use
            <a href="../ref/api/esp.html#group___esp_abbrev_1gaaef4ca7c60c2fd04b5c34fdc72f047d3">getFlash</a>:</p>
            <pre class="code">char *msg = getFeedback("inform");</pre>

            <p>If you need to pass a message from the controller into the next controller, use the flash message
            facility below.</p>
            <h3>Displaying Feedback Messages</h3>
            <p>To display feedback messages in a web page, use the
            <a href="../ref/api/esp.html#group___esp_abbrev_1ga8953966bf16fa8134e011a2b60bd0f4b">renderFeedback</a> API.
<pre class="code">
&lt;% renderFeedback("all"); %&gt;
</pre>
            <p>This will display all feedback messages.</p>



            <a id="configuring"></a>
            <h2>Configuring Session</h2>
            <p>Session data has a lifespan defined by the <a href="config.html#timeouts">http.timeouts</a>
               configuration directive. When this timeout expires, ESP will prune the data from the session
                store.</p>
            <p>If there is a low memory condition, ESP may prune session data prematurely to free up memory.
            The maximum memory limit may be configured by the
            <a href="config.html#limits">http.limits</a> configuration directive.</p>
            <a id="performance"></a>
            <h2>Performance Considerations</h2>
            <h3>Minimize Session Data Size</h3>
            <p>To maximize the performance of your application, try to minimize the size of data stored in the session
            state store. Session data is copied to and from the store. Unnecessary copies will slow your
            application.</p>
            <h3>Minimize Session Data Reads and Writes</h3>
            <p>It is important not to read from the session store repeatedly. During one request, try to read
            session data once and keep a reference to the data for the duration of that request.</p>
            <h3>Session Expiry Callbacks</h3>
            <p>Because session data may be stored remotely, ESP does not offer a callback when session state expires.
            Rather, you can test if session state has expired by calling
            <a href="../ref/api/esp.html#group___esp_req_1ga63a13780299e2781dca728d4087165bb">espGetSessionID</a>.</p>
            <p>The best design is to run a client-side session expiry inactivity timer which warns the user
            when the session is about to expire.</p>

    </div>
    <div class="terms ui basic center aligned segment">
        <p>&copy; Embedthis Software. All rights reserved.</p>
    </div>

    <script src="../lib/jquery/jquery.min.js"></script>
    <script src="../lib/semantic-ui/semantic.min.js"></script>
    <script src="../scripts/sidebar.min.js"></script>
     

    




